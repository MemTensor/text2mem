{
  "name": "Op Workflow - Merge",
  "steps": [
    {
      "name": "Seed: Encode meeting note A",
      "ir": {
        "_comment": "项目 A 的立项会上，我在飞书文档写下‘会议A：讨论项目范围。’，主要描述范围边界。先同步到记忆方便回顾。",
        "stage": "ENC",
        "op": "Encode",
        "args": {
          "payload": {
            "text": "会议A：讨论项目范围。"
          },
          "tags": ["meeting", "projectA"],
          "type": "note",
          "time": "2025-01-08T14:00:00+08:00",
          "source": "feishu_doc",
          "subject": "项目A 启动会",
          "topic": "范围讨论"
        }
      }
    },
    {
      "name": "Seed: Encode meeting note B",
      "ir": {
        "_comment": "第二场分工会的时候录音里提到‘会议B：确定人员分工。’，我把重点整理出来同样放进记忆。",
        "stage": "ENC",
        "op": "Encode",
        "args": {
          "payload": {
            "text": "会议B：确定人员分工。"
          },
          "tags": ["meeting", "projectA"],
          "type": "note",
          "time": "2025-01-10T10:30:00+08:00",
          "source": "meeting_transcript",
          "subject": "项目A 分工会",
          "topic": "人员安排"
        }
      }
    },
    {
      "name": "Dry-run merge default (no primary_id)",
      "ir": {
        "_comment": "负责人想先看看两场会议合并后的预览效果，于是让我对 meeting+projectA 的记忆做一次 dry-run merge，不真正落地。",
        "stage": "STO",
        "op": "Merge",
        "target": {
          "filter": {
            "has_tags": ["meeting", "projectA"],
            "limit": 50
          }
        },
        "args": {
          "primary_id": "auto"
        },
        "meta": {
          "dry_run": true
        }
      }
    },
    {
      "name": "Merge meeting notes (default merge_into_primary)",
      "ir": {
        "_comment": "预览 ok 后，再正式合并这些会议记忆，默认把第一条作为主记录。",
        "stage": "STO",
        "op": "Merge",
        "target": {
          "filter": {
            "has_tags": ["meeting", "projectA"],
            "limit": 50
          }
        },
        "args": {
          "primary_id": "auto"
        }
      }
    },
    {
      "name": "Merge meeting notes via search+filter (default)",
      "ir": {
        "_comment": "为了验证搜索 + filter 联合作用，再用‘会议’做语义检索并叠加 projectA 标签，执行一次默认合并。",
        "stage": "STO",
        "op": "Merge",
        "target": {
          "search": {
            "intent": {
              "query": "会议"
            },
            "overrides": {
              "limit": 2
            },
            "limit": 2
          },
          "filter": {
            "has_tags": ["meeting", "projectA"],
            "limit": 50
          }
        },
        "args": {
          "primary_id": "auto"
        }
      }
    }
  ]
}
